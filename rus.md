# Введение в сущности и компоненты

Представьте, что вы создаете ролевую игру. Вы можете выбирать между 4 игровыми
персонажами, которые существенно отличаются друг от друга - это достаточно просто
реализуется классическим способом (или даже через обычные объекты). Например:

    var Hero = function() {
        this.health = 100;
        this.power = 20;
        this.sprite = 'hero.png';
        this.weapon = 'spear';
        this.damage = 20;
    };
    
    var hero1 = newHero();

## Старым оркам тут не место

Здорово, оно работает, хотя и не идеально. Что, если мы захотим добавить нового
персонажа позже? И что с врагами?

Давайте пока забудем о дополнительных персонажах (оставим это для загружаемого
контента) и попробуем сосредоточиться на врагах. Представим, что мы хотим, чтобы
наши орки генерировались рандомно (ура многообразию) из определенного набора 
свойств - может быть, мы хотим несколько сильных и несколько слабых, может 
быть некоторых с луками, других с топорами.

Лучшим подходом к решению этих вопросов является использование системы сущностей
и компонентов (*entities and components system, сокращенно ECS - прим.пер.*).

![Мстители, к оружию!][Изображение]

## Йо, чел, я слышал ты любишь компоненты

Представим компоненты как небольшие строительные блоки, которые, собранные вместе,
формируют нашего врага. Для нашего фольклорного орка, наверное, можно сделать 
что-то такое:

    var components = {
      orc: function(entity){
        entity.health = 100;
        entity.humanoid = true;
        entity.color =  'green';
      },
    
      strong: function(entity){
        if(entity.health !== null)
          entity.health = entity.health*1.25;
      },
      
      axe: function(entity){
        entity.weapon = 'Axe';
        entity.damage = 5;
        entity.critMulti = 4;
        entity.critChance = 20;
      }
    };

И тогда мы можем сделать так:

    var orc1 = {};
    components.orc(orc1);
    components.strong(orc1);
    components.axe(orc1);

И вот мы подготовили вооруженного, крепкого орка! Как легко и просто мы это 
сделали? Если мы захотим создать человека, вооруженного топором, мы сможем
переиспользовать компонент ‘axe’(топор). Если мы создадим Кракена, мы сможем
переиспользовать компонент ‘strong’(сила).

## Системный шок

Код выше берет на себя заботы о врагах и их компонентах. Но мы все еще нуждаемся
в том, чтобы управлять ими - как мы будем это делать?

Вот где начинается самое интересное. Вы можете иметь многообразные системы,
для управления логикой действий всех врагов, что будет реализовано через
компоненты. Например, физическая система должна проверять на пересечения тех
врагов, что имеют свойство ‘physics’(физический).

Чтобы осуществить это, нам нужно добавить всех врагов в список. Так мы сможем
обходить их в цикле и делать вещи наподобие этих:

    // Враг будет нападать на вас, только если вы оба вооружены или безоружны
    // Если он в невыгодном положении, он будет убегать

    for(var i = 0; i < entities.length; i++){
        if (player.armed && !entity[i].armed){
            entity[i].run();
        } else{
            entity[i].fight();
        }
    }

## Улучшаем это 

Кто-то может сказать, что я не разбиваю вещи настолько, насколько это
возможно &mdash; здоровье может быть компонентом само по себе, как и все остальное.
Тогда станет возможным сгруппировать компоненты для упрощения процедуры создания
врагов.

Еще одной вещью, которая может быть улучшена, является связывание компонентов.
Например:

    var ECS = function(){
      return { // Возвращаем компоненты
          health: function() {
            this.health= 100;
            return this; // We return the object
          },
          strong: function(){
              if(this.health !== null)
                  this.health = this.health*1.25;
              return this;
          }
      };
    };

Это предоставляет нам немного больше гибкости и возможность формировать цепочки
наподобие:

    var orc = new ECS();
    orc.health().strong(); // Легко и просто
    
    var orc2 = new ECS()
        .health()
        .strong(); // Еще проще

## Примеры из жизни

[CraftyJS][2] является игровым фреймворком, построенным вокруг ECS, также
существуют независимые фреймворки, которые могут быть встроены в игровые движки,
как [ces.js][3], или вы можете создать свой собственный! Хорошим местом, где можно
узнать больше является [урок по созданию игры "Поедатель прямоугольников"][4].

Надеюсь это было полезным, дайте мне знать, что вы думаете, в комментариях!

[2]: http://invrse.co/entities-and-components-system/craftyjs.com/
[3]: https://github.com/qiao/ces.js
[4]: http://vasir.net/blog/game-development/how-to-build-entity-component-system-in-javascript

[Изображение]: img/ecs_orc.png